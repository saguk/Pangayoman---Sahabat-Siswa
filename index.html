<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pangayoman - Sahabat Siswa</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@0.469.0/dist/umd/lucide-react.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        
        /* Glassmorphism & Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.05);
        }
        
        /* Animations */
        .animate-enter { animation: enter 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-blob { animation: blob 7s infinite; }
        @keyframes enter { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        
        .sos-pulse { animation: sos 1.5s infinite; }
        @keyframes sos {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Scrollbar Hide */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom Gradients */
        .bg-gradient-brand { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .text-gradient { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const COUNSELOR_PHONE = "628123456789"; 

        // --- ICON HELPER ---
        const Icon = ({ name, size = 20, className }) => {
            try {
                const lucide = window.lucideReact;
                if (!lucide) return null;
                const pascalName = name.split('-').map(part => part.charAt(0).toUpperCase() + part.slice(1)).join('');
                const LucideIcon = lucide[pascalName];
                return LucideIcon ? <LucideIcon size={size} className={className} /> : <span className="text-[8px] text-red-500">{name}</span>;
            } catch (e) { return null; }
        };

        // --- DATA UTILS ---
        const loadData = (key, def) => { try { return JSON.parse(localStorage.getItem(key)) || def; } catch { return def; } };
        const saveData = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        
        const generateDates = () => {
            const dates = [];
            const days = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            for (let i = 1; i <= 7; i++) { 
                const d = new Date();
                d.setDate(d.getDate() + i);
                if (d.getDay() === 0) continue; 
                dates.push({
                    fullDate: d,
                    dayName: days[d.getDay()],
                    dateNum: d.getDate(),
                    monthName: months[d.getMonth()],
                    formatted: `${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}`
                });
            }
            return dates;
        };

        const sendWA = (data) => {
            let text = "";
            if (data.type === "SOS DARURAT") {
                text = `ðŸš¨ *SOS! SINYAL DARURAT*\n\nNama: ${data.senderName}\nLokasi/Info: ${data.content}\n\nMOHON SEGERA DIRESPON!`;
            } else if (data.type === "Booking Jadwal") {
                text = `ðŸ“… *Request Jadwal Konseling*\n\nNama: ${data.senderName}\nTanggal: ${data.bookingDate}\nJam: ${data.bookingTime}\n\nMohon konfirmasi ketersediaan.`;
            } else {
                text = `ðŸ“© *Laporan Siswa Masuk*\n\nNama: ${data.anonymous ? 'Anonim' : data.senderName}\nIsi: ${data.content}\n\nDikirim via Pangayoman.`;
            }
            window.open(`https://wa.me/${COUNSELOR_PHONE}?text=${encodeURIComponent(text)}`, '_blank');
        };

        // --- SHARED COMPONENTS ---
        const Notification = ({ msg, type, onClose }) => {
            useEffect(() => { const t = setTimeout(onClose, 3000); return () => clearTimeout(t); }, []);
            return (
                <div className="fixed top-6 right-6 z-[100] animate-enter">
                    <div className={`px-6 py-4 rounded-2xl shadow-2xl border flex items-center gap-3 glass ${type==='err'?'border-red-200 text-red-600 bg-red-50/90':'border-green-200 text-green-600 bg-green-50/90'}`}>
                        <Icon name={type==='err'?'alert-circle':'check-circle'} className="stroke-[2.5]" />
                        <span className="font-bold tracking-tight">{msg}</span>
                    </div>
                </div>
            );
        };

        const ConfirmModal = ({ title, msg, onOk, onCancel }) => (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4 animate-enter">
                <div className="bg-white rounded-3xl p-6 max-w-sm w-full shadow-2xl ring-1 ring-slate-900/5">
                    <h3 className="text-lg font-bold text-slate-900 mb-2">{title}</h3>
                    <p className="text-slate-500 mb-6 leading-relaxed">{msg}</p>
                    <div className="flex gap-3">
                        <button onClick={onCancel} className="flex-1 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-bold text-sm transition">Batal</button>
                        <button onClick={onOk} className="flex-1 py-3 bg-gradient-brand text-white rounded-xl font-bold text-sm shadow-lg shadow-indigo-200 transition transform hover:scale-[1.02]">Ya, Lanjut</button>
                    </div>
                </div>
            </div>
        );

        // --- LOGO COMPONENT ---
        const Logo = ({ className = "w-32" }) => {
            const [customLogo, setCustomLogo] = useState(null);
            const [error, setError] = useState(false);
            const fileInputRef = useRef(null);
            
            // Mencoba link JPG (sesuai nama file upload user)
            const defaultLogoUrl = "https://i.imgur.com/DXeQLEH.jpg";

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const objectUrl = URL.createObjectURL(file);
                    setCustomLogo(objectUrl);
                    setError(false);
                }
            };

            const triggerUpload = () => fileInputRef.current?.click();

            return (
                <div className="flex flex-col items-center mb-8 group">
                    <input 
                        type="file" 
                        ref={fileInputRef} 
                        onChange={handleFileChange} 
                        accept="image/*" 
                        className="hidden" 
                    />
                    
                    {!error ? (
                        <div className="relative cursor-pointer" onClick={triggerUpload} title="Klik untuk ganti logo">
                            <img 
                                src={customLogo || defaultLogoUrl} 
                                alt="Logo Sekolah" 
                                referrerPolicy="no-referrer"
                                className={`${className} h-auto object-contain hover:scale-105 transition drop-shadow-2xl`}
                                onError={() => !customLogo && setError(true)}
                            />
                            {/* Hover Edit Icon */}
                            <div className="absolute inset-0 flex items-center justify-center bg-black/20 rounded-full opacity-0 group-hover:opacity-100 transition-opacity">
                                <Icon name="pencil" className="text-white drop-shadow-md" size={16} />
                            </div>
                        </div>
                    ) : (
                        <div onClick={triggerUpload} className="w-24 h-24 bg-gradient-brand rounded-2xl flex flex-col items-center justify-center text-white shadow-xl cursor-pointer hover:scale-105 transition">
                            <Icon name="upload-cloud" size={32} />
                            <span className="text-[10px] mt-2 font-bold">Upload Logo</span>
                        </div>
                    )}
                </div>
            );
        };

        // --- PAGE 1: LANDING ---
        const LandingPage = ({ setView, setStudentName }) => {
            const [tempName, setTempName] = useState('');
            return (
                <div className="min-h-screen flex items-center justify-center p-6 relative z-10">
                    <div className="glass-card p-8 rounded-[2rem] max-w-md w-full text-center">
                        
                        <Logo className="w-40 mx-auto" />

                        <h1 className="text-3xl font-extrabold mb-2 text-slate-900">Pangayoman</h1>
                        <p className="text-slate-500 mb-8 leading-relaxed">Ruang aman untuk bercerita, melapor, dan menemukan solusi bersama Guru BK.</p>
                        
                        <div className="space-y-4">
                            <div className="bg-white p-1 rounded-2xl border focus-within:ring-2 ring-indigo-100 transition shadow-sm">
                                <input 
                                    type="text" 
                                    placeholder="Siapa namamu?" 
                                    className="w-full p-3 rounded-xl outline-none text-center bg-transparent"
                                    value={tempName}
                                    onChange={e => setTempName(e.target.value)}
                                />
                            </div>
                            <button 
                                disabled={!tempName.trim()}
                                onClick={() => { setStudentName(tempName); setView('student'); }}
                                className="w-full bg-slate-900 hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 transition shadow-lg shadow-slate-200"
                            >
                                Masuk Aplikasi <Icon name="arrow-right" size={18}/>
                            </button>
                            
                            <div className="relative py-4">
                                <div className="absolute inset-0 flex items-center"><span className="w-full border-t border-slate-200"></span></div>
                                <div className="relative flex justify-center text-xs uppercase"><span className="bg-white px-2 text-slate-400">Atau</span></div>
                            </div>

                            <button onClick={() => setView('login')} className="w-full py-3 text-slate-500 hover:text-indigo-600 font-semibold text-sm transition">
                                Login Guru BK
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- PAGE 2: STUDENT VIEW ---
        const StudentView = ({ name, setView, onSubmit, notify, setModal }) => {
            const [page, setPage] = useState('home');
            const [mood, setMood] = useState(-1);
            
            // State Form Booking
            const [bookDate, setBookDate] = useState(null); 
            const [bookTime, setBookTime] = useState(null);
            const [availableDates] = useState(generateDates());
            const timeSlots = ["08:00", "09:00", "10:15", "11:00", "13:00", "14:00"];

            const handleSOS = () => {
                setModal({
                    title: 'DARURAT SOS?',
                    msg: 'Ini akan mengirim sinyal bahaya ke Guru BK. Gunakan hanya saat mendesak.',
                    onOk: () => {
                        onSubmit({ type: 'SOS DARURAT', senderName: name, content: 'Siswa menekan tombol SOS Darurat!', urgency: 'Darurat', anonymous: false });
                        setModal(null);
                    },
                    onCancel: () => setModal(null)
                });
            };

            const handleBooking = () => {
                if(!bookDate || !bookTime) return notify('Pilih Hari & Jam dulu', 'err');
                onSubmit({
                    type: 'Booking Jadwal',
                    senderName: name,
                    bookingDate: bookDate.formatted,
                    bookingTime: bookTime,
                    content: `Booking untuk ${bookDate.formatted} jam ${bookTime}`,
                    urgency: 'Sedang',
                    anonymous: false
                });
                setPage('home');
                setBookDate(null); setBookTime(null);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative pb-24">
                    {/* Header */}
                    <div className="bg-slate-900 p-8 rounded-b-[2.5rem] shadow-xl relative overflow-hidden text-white z-10">
                        <div className="absolute top-0 right-0 p-10 bg-indigo-500 rounded-full blur-3xl opacity-30 -mr-10 -mt-10"></div>
                        <div className="flex justify-between items-center mb-6 relative">
                            <div>
                                <p className="text-slate-400 text-sm mb-1">Selamat Datang,</p>
                                <h2 className="text-2xl font-bold">{name} ðŸ‘‹</h2>
                            </div>
                            <button onClick={()=>setView('landing')} className="bg-white/10 p-2.5 rounded-xl hover:bg-white/20 transition backdrop-blur-sm"><Icon name="log-out" size={18}/></button>
                        </div>
                        
                        <div className="bg-white/10 p-4 rounded-2xl backdrop-blur-md border border-white/10">
                            <p className="text-xs text-slate-300 mb-3 text-center">Bagaimana perasaanmu hari ini?</p>
                            <div className="flex justify-between px-2">
                                {['ðŸ˜¡','ðŸ˜¢','ðŸ˜','ðŸ™‚','ðŸ¤©'].map((e,i)=>(
                                    <button key={i} onClick={()=>setMood(i)} className={`text-2xl transition-all duration-300 hover:scale-125 ${mood===i ? 'scale-150 drop-shadow-lg' : 'opacity-60 grayscale hover:grayscale-0'}`}>{e}</button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="p-6 mt-2 relative z-0 animate-enter">
                        {page === 'home' && (
                            <div className="space-y-5">
                                <button onClick={handleSOS} className="w-full bg-gradient-to-r from-red-500 to-pink-600 text-white p-5 rounded-3xl shadow-xl shadow-red-200 sos-pulse flex items-center gap-4 relative overflow-hidden group">
                                    <div className="bg-white/20 p-3 rounded-full"><Icon name="bell-ring" size={24} className="animate-bounce" /></div>
                                    <div className="text-left">
                                        <h3 className="font-bold text-lg">TOMBOL SOS</h3>
                                        <p className="text-xs text-red-100 opacity-90">Tekan hanya jika dalam bahaya!</p>
                                    </div>
                                    <div className="absolute -right-4 -bottom-4 opacity-10"><Icon name="alert-triangle" size={100}/></div>
                                </button>

                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={()=>setPage('report')} className="p-5 rounded-3xl border border-slate-100 bg-white shadow-lg shadow-slate-100 hover:-translate-y-1 transition text-left group">
                                        <div className="w-12 h-12 rounded-2xl bg-orange-50 text-orange-500 flex items-center justify-center mb-3 group-hover:scale-110 transition"><Icon name="message-square-warning" /></div>
                                        <h3 className="font-bold text-slate-800">Lapor</h3>
                                        <p className="text-xs text-slate-400 mt-1">Bullying / Masalah</p>
                                    </button>
                                    <button onClick={()=>setPage('booking')} className="p-5 rounded-3xl border border-slate-100 bg-white shadow-lg shadow-slate-100 hover:-translate-y-1 transition text-left group">
                                        <div className="w-12 h-12 rounded-2xl bg-indigo-50 text-indigo-500 flex items-center justify-center mb-3 group-hover:scale-110 transition"><Icon name="calendar-heart" /></div>
                                        <h3 className="font-bold text-slate-800">Curhat</h3>
                                        <p className="text-xs text-slate-400 mt-1">Booking Jadwal</p>
                                    </button>
                                </div>

                                <div className="p-5 rounded-3xl bg-blue-50 border border-blue-100 flex gap-4 items-center">
                                    <div className="text-blue-500"><Icon name="info" /></div>
                                    <p className="text-xs text-blue-700 leading-relaxed">Rahasia terjamin. Ceritamu aman bersama Guru BK.</p>
                                </div>
                            </div>
                        )}

                        {page === 'report' && (
                            <div className="animate-enter">
                                <div className="flex items-center gap-3 mb-6">
                                    <button onClick={()=>setPage('home')} className="p-2 hover:bg-slate-100 rounded-full"><Icon name="arrow-left"/></button>
                                    <h2 className="text-xl font-bold">Form Laporan</h2>
                                </div>
                                <form onSubmit={(e)=>{
                                    e.preventDefault();
                                    onSubmit({
                                        type: 'Laporan Masalah',
                                        senderName: e.target.anon.checked ? 'Anonim' : name,
                                        content: e.target.content.value,
                                        urgency: 'Sedang',
                                        anonymous: e.target.anon.checked
                                    });
                                    setPage('home');
                                }}>
                                    <div className="mb-4">
                                        <label className="block text-sm font-bold text-slate-700 mb-2">Apa yang terjadi?</label>
                                        <textarea name="content" className="w-full p-4 rounded-2xl bg-slate-50 border focus:bg-white focus:ring-2 ring-indigo-100 outline-none transition" rows="6" placeholder="Ceritakan kronologinya..." required></textarea>
                                    </div>
                                    <div className="flex items-center justify-between bg-slate-50 p-4 rounded-2xl mb-6">
                                        <span className="text-sm font-semibold text-slate-600">Kirim sebagai Anonim</span>
                                        <input type="checkbox" name="anon" className="w-5 h-5 accent-indigo-600"/>
                                    </div>
                                    <button className="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 transition shadow-lg">Kirim Laporan</button>
                                </form>
                            </div>
                        )}

                        {page === 'booking' && (
                            <div className="animate-enter">
                                <div className="flex items-center gap-3 mb-6">
                                    <button onClick={()=>setPage('home')} className="p-2 hover:bg-slate-100 rounded-full"><Icon name="arrow-left"/></button>
                                    <h2 className="text-xl font-bold">Pilih Jadwal Curhat</h2>
                                </div>

                                <div className="mb-6">
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Pilih Hari & Tanggal</label>
                                    <div className="flex gap-3 overflow-x-auto pb-4 hide-scrollbar snap-x">
                                        {availableDates.map((d, i) => (
                                            <button key={i} onClick={() => setBookDate(d)} 
                                                className={`min-w-[4.5rem] p-3 rounded-2xl border transition snap-start flex flex-col items-center justify-center ${bookDate?.dateNum === d.dateNum ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg shadow-indigo-200' : 'bg-white border-slate-200 text-slate-600 hover:border-indigo-300'}`}>
                                                <span className="text-xs opacity-80 mb-1">{d.dayName}</span>
                                                <span className="text-xl font-bold">{d.dateNum}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-8">
                                    <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Pilih Jam</label>
                                    <div className="grid grid-cols-3 gap-3">
                                        {timeSlots.map((t, i) => (
                                            <button key={i} onClick={() => setBookTime(t)}
                                                className={`py-3 rounded-xl border text-sm font-bold transition ${bookTime === t ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white border-slate-200 text-slate-600 hover:border-indigo-300'}`}>
                                                {t}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={handleBooking} disabled={!bookDate || !bookTime} className="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-lg">
                                    Buat Janji Temu
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- PAGE 3: LOGIN PAGE ---
        const LoginPage = ({ admins, onLogin, setView, notify }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                const user = admins.find(a => a.username === username && a.password === password && a.isActive);
                if (user) {
                    notify('Login Berhasil!');
                    onLogin(user);
                } else {
                    notify('Username/Password salah', 'err');
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-6 relative z-10">
                    <div className="glass-card p-8 rounded-[2rem] max-w-sm w-full text-center">
                        <Logo className="w-24 mx-auto" />
                        
                        <div className="flex items-center justify-center gap-3 mb-6">
                             <h2 className="text-xl font-bold">Login Guru BK</h2>
                        </div>
                        <form onSubmit={handleLogin} className="space-y-4 text-left">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-2 uppercase">Username</label>
                                <input type="text" value={username} onChange={e=>setUsername(e.target.value)} className="w-full p-3 rounded-xl bg-white/50 border focus:bg-white outline-none transition" required />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-2 uppercase">Password</label>
                                <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full p-3 rounded-xl bg-white/50 border focus:bg-white outline-none transition" required />
                            </div>
                            <button className="w-full py-3 bg-gradient-brand text-white rounded-xl font-bold shadow-lg shadow-indigo-200 mt-4">Masuk Dashboard</button>
                            <button type="button" onClick={()=>setView('landing')} className="w-full py-2 text-slate-400 hover:text-slate-600 text-sm font-bold transition">Kembali</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- PAGE 4: ADMIN VIEW ---
        const AdminView = ({ user, setView, reports, setReports, admins }) => {
            const [tab, setTab] = useState('all');

            const filteredReports = reports.filter(r => {
                if (tab === 'all') return true;
                if (tab === 'sos') return r.type === 'SOS DARURAT';
                if (tab === 'booking') return r.type === 'Booking Jadwal';
                return r.type === 'Laporan Masalah';
            });

            const updateStatus = (id, newStatus) => {
                const updated = reports.map(r => r.id === id ? { ...r, status: newStatus } : r);
                setReports(updated);
            };

            return (
                <div className="min-h-screen bg-slate-50 pb-20">
                    {/* Admin Header */}
                    <div className="bg-white border-b px-6 py-4 sticky top-0 z-20 flex justify-between items-center shadow-sm">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold">
                                {user.name.charAt(0)}
                            </div>
                            <div>
                                <h1 className="font-bold text-slate-800 leading-tight">{user.name}</h1>
                                <p className="text-xs text-slate-500">Guru BK Panel</p>
                            </div>
                        </div>
                        <button onClick={()=>setView('landing')} className="text-slate-400 hover:text-red-500 transition"><Icon name="log-out"/></button>
                    </div>

                    <div className="max-w-3xl mx-auto p-6">
                        {/* Stats */}
                        <div className="grid grid-cols-3 gap-4 mb-8">
                            <div className="bg-white p-4 rounded-2xl border shadow-sm">
                                <div className="text-2xl font-bold text-indigo-600">{reports.length}</div>
                                <div className="text-xs text-slate-500">Total Masuk</div>
                            </div>
                            <div className="bg-white p-4 rounded-2xl border shadow-sm">
                                <div className="text-2xl font-bold text-red-500">{reports.filter(r=>r.type==='SOS DARURAT').length}</div>
                                <div className="text-xs text-slate-500">SOS Darurat</div>
                            </div>
                            <div className="bg-white p-4 rounded-2xl border shadow-sm">
                                <div className="text-2xl font-bold text-orange-500">{reports.filter(r=>r.status==='Menunggu').length}</div>
                                <div className="text-xs text-slate-500">Perlu Respon</div>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-6 overflow-x-auto hide-scrollbar">
                            {['all', 'sos', 'booking', 'laporan'].map(t => (
                                <button key={t} onClick={()=>setTab(t)} 
                                    className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition ${tab===t ? 'bg-slate-900 text-white' : 'bg-white border text-slate-500 hover:bg-slate-100'}`}>
                                    {t === 'all' ? 'Semua' : t.toUpperCase()}
                                </button>
                            ))}
                        </div>

                        {/* List */}
                        <div className="space-y-4">
                            {filteredReports.length === 0 && (
                                <div className="text-center py-12 text-slate-400">Belum ada data masuk.</div>
                            )}
                            {filteredReports.map(item => (
                                <div key={item.id} className="bg-white p-5 rounded-2xl border shadow-sm animate-enter">
                                    <div className="flex justify-between items-start mb-3">
                                        <span className={`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider ${
                                            item.type === 'SOS DARURAT' ? 'bg-red-100 text-red-600' :
                                            item.type === 'Booking Jadwal' ? 'bg-indigo-100 text-indigo-600' : 'bg-orange-100 text-orange-600'
                                        }`}>
                                            {item.type}
                                        </span>
                                        <span className="text-xs text-slate-400">{item.timestamp}</span>
                                    </div>
                                    
                                    <h3 className="font-bold text-lg mb-1">{item.anonymous ? 'Siswa Anonim' : item.senderName}</h3>
                                    <p className="text-slate-600 text-sm leading-relaxed bg-slate-50 p-3 rounded-xl mb-4">
                                        {item.content}
                                    </p>

                                    <div className="flex items-center justify-between border-t pt-4">
                                        <div className="flex items-center gap-2">
                                            <span className={`w-2 h-2 rounded-full ${item.status==='Selesai'?'bg-green-500':'bg-yellow-500'}`}></span>
                                            <span className="text-xs font-semibold text-slate-600">{item.status}</span>
                                        </div>
                                        <div className="flex gap-2">
                                            {item.status !== 'Selesai' && (
                                                <button onClick={()=>updateStatus(item.id, 'Selesai')} className="px-4 py-2 bg-slate-100 hover:bg-green-100 text-slate-600 hover:text-green-600 rounded-lg text-xs font-bold transition">
                                                    Tandai Selesai
                                                </button>
                                            )}
                                            <button onClick={()=>sendWA(item)} className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-xs font-bold transition flex items-center gap-2">
                                                <Icon name="message-circle" size={14}/> Reply WA
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP ROOT ---
        function App() {
            const [view, setView] = useState('landing');
            const [studentName, setStudentName] = useState(''); 
            const [user, setUser] = useState(null); 
            const [notif, setNotif] = useState(null);
            const [modal, setModal] = useState(null);
            
            const [reports, setReports] = useState(loadData('db_reports_v3', []));
            const [admins, setAdmins] = useState(loadData('db_admins_v3', [{id:1, name:'Admin Utama', username:'admin', password:'123', isActive:true}]));

            useEffect(() => saveData('db_reports_v3', reports), [reports]);
            useEffect(() => saveData('db_admins_v3', admins), [admins]);

            const notify = (msg, type='ok') => setNotif({msg, type});
            
            const handleSubmit = (data) => {
                const newReport = {
                    id: Date.now(),
                    ...data,
                    status: 'Menunggu',
                    timestamp: new Date().toLocaleString()
                };
                setReports([newReport, ...reports]);
                
                if(data.type === 'SOS DARURAT') {
                    sendWA(newReport);
                    notify('SOS Terkirim!', 'ok');
                } else {
                    setModal({
                        title: 'Terkirim!',
                        msg: 'Data tersimpan di sistem. Mau kirim notifikasi WA ke Guru BK juga agar lebih cepat?',
                        onOk: () => { sendWA(newReport); setModal(null); },
                        onCancel: () => setModal(null)
                    });
                }
            };

            return (
                <div className="min-h-screen relative overflow-hidden text-slate-800 font-medium selection:bg-indigo-100">
                    {/* Background Blobs */}
                    <div className="fixed top-0 left-0 w-[500px] h-[500px] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
                    <div className="fixed bottom-0 right-0 w-[500px] h-[500px] bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>

                    {notif && <Notification msg={notif.msg} type={notif.type} onClose={()=>setNotif(null)} />}
                    {modal && <ConfirmModal {...modal} />}

                    {view === 'landing' && <LandingPage setView={setView} setStudentName={setStudentName} />}
                    {view === 'student' && <StudentView name={studentName} setView={setView} onSubmit={handleSubmit} notify={notify} setModal={setModal} />}
                    {view === 'login' && <LoginPage admins={admins} onLogin={(u)=>{setUser(u); setView('admin');}} setView={setView} notify={notify} />}
                    {view === 'admin' && user && <AdminView user={user} setView={setView} reports={reports} setReports={setReports} admins={admins} setAdmins={setAdmins} notify={notify} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>